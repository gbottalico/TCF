<section class="containerUtenti">

    <div class="ui-widget-header" style="padding:4px 10px;border-bottom: 0 none">
        <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
        <input #gb type="text" pInputText size="30" placeholder="Filtra utenti">
    </div>
    <p-dataTable [value]="users" emptyMessage="Nessun utente trovato" scrollable="true" selectionMode="single" [paginator]="true"
        [rows]="8" [globalFilter]="gb" responsive="true">
        <p-header>
            <div>
                <label>Lista Utenti</label>
                <button style="float: left;" type="button" pButton (click)=addNewUser() label="Aggiungi Utente"></button>
            </div>
        </p-header>
        <p-column header="Azioni" visible="true" [style]="{'width':'5%'}">
            <ng-template let-row="rowData" let-index="rowIndex" pTemplate="user">
                <span style="display: inline-block;">
                        <i class="fa fa-pencil-square-o modifica" aria-hidden="true" (click)="editRow(row, index)"></i>   
                        <i class="fa fa-trash-o elimina" aria-hidden="true" (click)="deleteRow(row, index)"></i>
                    </span>
            </ng-template>
        </p-column>
        <p-column field="nome" header="Nome" [sortable]="true"></p-column>
        <p-column field="cognome" header="Cognome" [sortable]="true"></p-column>
        <p-column field="clienti" header="Clienti">
            <ng-template let-row="rowData" let-index="rowIndex" pTemplate="body">
                <ng-container *ngIf="users[index].clienti != null">
                    <span *ngFor="let cliente of row.clienti; let i=index">{{cliente.id_cliente}}{{i+1 < row.clienti.length ? ', ' : null}}</span>
                </ng-container>
            </ng-template>
        </p-column>
    </p-dataTable>


    <p-dialog id="dialog" [(header)]="headerUtente" [(visible)]="displayDialog" modal="true" responsive="true" appendTo="body"
        scrollable="true">

        <div class="halfWidth noPaddingLeft">
            <div class="ui-g ui-fluid">
                <div class="ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                                <input class="input" id="cognome" type="text" pInputText [(ngModel)]="newUser.cognome">
                                <label for="cognome">Cognome</label>
                            </span>
                </div>
            </div>
            <div class="ui-g ui-fluid">
                <div class="ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                                <input class="input"  id="nome" type="text" pInputText [(ngModel)]="newUser.nome">
                                <label for="nome">Nome</label>
                            </span>
                </div>
            </div>
            <div class="ui-g ui-fluid">
                <div class="ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                            <input class="input"  id="email" type="text" pInputText [(ngModel)]="newUser.email">
                            <label for="email">Email</label>
                        </span>
                </div>
            </div>
            <div class="ui-g ui-fluid">
                <div class="ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                            <p-calendar id="dataInizio" [(ngModel)]="newUser.data_inizio_validita" dateFormat="dd/mm/yy" [showIcon]="true" appendTo="body"></p-calendar>
                            <label for="dataInizio">Data Inizio Validita (dd/mm/aa)</label>
                        </span>
                </div>
            </div>
            <div class="ui-g ui-fluid">
                <div class="ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                            <p-calendar id="dataFine" [(ngModel)]="newUser.data_fine_validita" dateFormat="dd/mm/yy" [showIcon]="true" appendTo="body"></p-calendar>
                            <label for="dataFine">Data Fine Validita (dd/mm/aa)</label>
                        </span>
                </div>
            </div>
        </div>

        <div class="halfWidth noPaddingRight">
            <div class="ui-g ui-fluid">
                <div class="ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                            <input class="input"  id="user" type="text" pInputText [(ngModel)]="newUser._id">
                            <label for="user">User</label>
                        </span>
                </div>
            </div>
            <div class="ui-g ui-fluid" *ngIf="this.userIndex == null">
                <div class="ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                            <input class="input"  id="password" type="text" pInputText [(ngModel)]="newUser.password">
                            <label for="password">Password</label>
                        </span>
                </div>
            </div>
            <div class="ui-g ui-fluid">
                <p-dropdown class="ui-g-12 ui-md-12" [options]="sediList" [style]="{'width':'100%'}" placeholder="Seleziona sede" [(ngModel)]="newUser.id_sede">
                </p-dropdown>
            </div>
            <div class="ui-g ui-fluid">
                <p-dropdown class="ui-g-12 ui-md-12" [options]="admins" [style]="{'width':'100%'}" placeholder="Amm. di Sistema" [(ngModel)]="newUser.isAdmin"></p-dropdown>
            </div>
            <!-- <div class="ui-g ui-fluid">
                    <p-multiSelect class="ui-g-12 ui-md-12" [options]="clientiComboBox" [(ngModel)]="selectedClients" [panelStyle]="{minWidth:'12em'}"
                        defaultLabel="Seleziona cliente" maxSelectedLabels="10" scrollable="false">
                    </p-multiSelect>
                </div> -->
        </div>
        <div style="clear:both;">
            <p-dataTable [value]="newUser.clienti" emptyMessage="Nessun cliente trovato" scrollable="true" [style]="{'width':'60%'}" scrollHeight="200px">
                <p-header>
                    <div style="width:100%;text-align:center;">
                        <label>Lista Clienti</label>
                        <button style="float: left;" pButton type="button" icon="fa fa-plus" (click)="addCliente()" label="Aggiungi Cliente"></button>
                    </div>
                </p-header>
                <p-column [style]="{'width':'5%'}">
                    <ng-template let-row="rowData" let-index="rowIndex" pTemplate="body">
                        <button style="display: inline-block;" pButton type="button" icon="fa fa-trash" (click)="deleteClientRow(row, index)"></button>
                    </ng-template>
                </p-column>
                <p-column field="id_cliente" header="Cliente">
                    <ng-template let-row="rowData" let-index="rowIndex" pTemplate="body">
                        <p-dropdown [options]="clientiComboBox" [autoWidth]="false" required="true" [(ngModel)]="row.id_cliente" [style]="{'width':'100%'}"
                            required="true" appendTo="body" placeholder="Seleziona cliente"></p-dropdown>
                    </ng-template>
                </p-column>
                <p-column field="id_profilo" header="Profilo">
                    <ng-template let-index="rowIndex" let-row="rowData" pTemplate="body">
                        <p-dropdown [options]="profili" [(ngModel)]="row.id_profilo" required="true" [autoWidth]="false" [style]="{'width':'100%'}"
                            required="true" appendTo="body" placeholder="Seleziona profilo"></p-dropdown>
                    </ng-template>
                </p-column>
                <p-column field="data_inizio_validita_cliente" header="Data Inizio">
                    <ng-template let-row="rowData" let-index="rowIndex" pTemplate="body">
                        <!-- [minDate]="minClientDate[index] | date:'dd/mm/yy'" [maxDate]="maxClientDate[index]"  -->
                        <p-calendar id="dataInizio" placeholder="Data Inizio (dd/mm/aa)" required="true" [inputStyle]="{'width':'90%'}" [(ngModel)]="row.data_inizio_validita_cliente"
                            dateFormat="dd/mm/yy" [style]="{'width':'100%'}" [showIcon]="true" appendTo="body"></p-calendar>

                    </ng-template>
                </p-column>
                <p-column field="data_fine_validita_cliente" header="Data Fine">
                    <ng-template let-row="rowData" let-index="rowIndex" pTemplate="body">
                        <p-calendar id="dataFine" placeholder="Data Fine (dd/mm/aa)" [inputStyle]="{'width':'90%'}" [(ngModel)]="row.data_fine_validita_cliente"
                            dateFormat="dd/mm/yy" [style]="{'width':'100%'}" [showIcon]="true" appendTo="body"></p-calendar>
                    </ng-template>
                </p-column>
            </p-dataTable>
        </div>
        <p-footer>
            <div class="ui-dialog-buttonpane ui-helper-clearfix">
                <button type="button" class="btn btnPrimary aggiungi" (click)="saveNew()">{{this.btnDialog}}</button>
            </div>
        </p-footer>
    </p-dialog>

    <p-confirmDialog acceptLabel="Elimina" rejectLabel="Annulla" appendTo="body"></p-confirmDialog>

</section>