<p-dataTable [value]="consuntivi" scrollable="true" frozenWidth="470px" unfrozenWidth="calc( 100% - 470px)" columnResizeMode="fit"
    [style]="{'margin-top':'30px'}">

    <p-header>
        <div>
            <label style="vertical-align: middle;text-align: center;">{{monthSelected}}/{{yearSelected}}</label>
            <button style="float: left;" type="button" pButton (click)=showDialogToAdd() label="Aggiungi Attività"></button>
        </div>
    </p-header>
    <p-column field="isEditable" header="" frozen="true" [editable]="isEditable" [style]="{'width':'30px','overflow':'visible'}">
        <ng-template let-col let-row="rowData" let-index="rowIndex" pTemplate="body">
            <span *ngIf="!row.isEditable">
                <i class="fa fa-pencil-square-o modifica" aria-hidden="true" (click)="edit(row,index)"></i>
                <i class="fa fa-trash-o elimina" aria-hidden="true" (click)="delete(row,index)"></i>
            </span>
            <span *ngIf="row.isEditable">
                <i class="fa fa-floppy-o conferma" aria-hidden="true" (click)="saveEdit(row,index)"></i>
                <i class="fa fa-minus annulla" aria-hidden="true" (click)="abortEdit(row,index)"></i>
            </span>
        </ng-template>
    </p-column>

    <p-column frozen="true" header="Cliente/Ambito/Area" [editable]="isEditable">
        <ng-template let-col let-row="rowData" pTemplate="body">
            <span>{{row.nome_cliente}} - {{row.nome_ambito}} - {{row.nome_macro_area}}</span>
        </ng-template>
    </p-column>

    <p-column field="activity" frozen="true" header="Attività">
        <ng-template let-col let-row="rowData" pTemplate="body">
            <span *ngIf="!row.isEditable">{{row.nome_attivita}}</span>
            <span *ngIf="row.isEditable">
                <p-dropdown [options]="lst_attivita" [(ngModel)]="row.id_attivita" required="true" appendTo="body" placeholder="Seleziona attività" [autoWidth]="false" [style]="{'width':'100%'}"></p-dropdown>
            </span>
        </ng-template>
    </p-column>

    <p-column field="deliverable" frozen="true" header="Tipo Deliverable" [editable]="isEditable">
        <ng-template let-col let-row="rowData" pTemplate="body">
            <span *ngIf="!row.isEditable">{{row.nome_tipo_deliverable}}</span>
            <span *ngIf="row.isEditable">
                    <p-dropdown [options]="lst_deliverable" [(ngModel)]="row.id_tipo_deliverable" required="true" appendTo="body" placeholder="Seleziona deliverable" [autoWidth]="false" [style]="{'width':'100%'}"></p-dropdown>
            </span>
        </ng-template>
    </p-column>

    <p-column *ngFor="let col of cols" [field]="col.field" [header]="col.header" [style]="{'width':'20px', 'overflow':'inherit'}">
        <ng-template let-col let-row="rowData" pTemplate="body">
            <span *ngIf="!row.isEditable">{{row[col.field].ore}}</span>
            <span *ngIf="row.isEditable">
                <input type="number" min="0" max="23" class="from-control input inputDay" [(ngModel)]="row[col.field].ore">
            </span>
        </ng-template>
    </p-column>

    

</p-dataTable>

<p-dialog header="Nuova Attività" [(visible)]="displayDialog" appendTo="body" appendTo="body" showEffect="fade" [modal]="true">
    <form name="form" [formGroup]="activityForm" (ngSubmit)="checkForm(activityForm) && saveNew()" #f="ngForm" novalidate>
    <!-- <form name="form" (ngSubmit)="saveNew()" #f="ngForm" novalidate> -->
        <div class="ui-grid ui-fluid" *ngIf="newRowConsuntivo">
            <div class="ui-grid-row">

                <div class="ui-grid-col-12 ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                                <label for="ddl_clienti" style="top: -.60em;font-size:12px; color:#d6d6d6">Cliente</label>
                            </span>
                    <p-dropdown [ngModelOptions]="{standalone: true}"  formControlName="ddl_clienti" name="ddl_clienti" [options]="lst_clienti" [(ngModel)]="newRowConsuntivo.id_cliente" required="true"
                        appendTo="body" placeholder="Seleziona Cliente" [autoWidth]="false" [style]="{'width':'100%'}"></p-dropdown>
                    <label for="ddl_clienti" [ngStyle]="{'color': isValid((activityForm.get('ddl_clienti').touched || formSubmitted) && activityForm.get('ddl_clienti').errors)}">{{((activityForm.get('ddl_clienti').touched || formSubmitted) && activityForm.get('ddl_clienti').errors) ? "Seleziona Cliente" : "Cliente"}}</label>
                </div>
            </div>
            <div class="ui-grid-row">

                <div class="ui-grid-col-12 ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                                <label for="ddl_ambiti" style="top: -.60em;font-size:12px; color:#d6d6d6">Ambito</label>
                            </span>
                    <p-dropdown [ngModelOptions]="{standalone: true}" #ddl_ambiti name="ddl_ambiti" [options]="lst_ambiti" [(ngModel)]="newRowConsuntivo.id_ambito" required="true"
                        appendTo="body" placeholder="Seleziona Ambito" [autoWidth]="false" [style]="{'width':'100%'}"></p-dropdown>
                    <div *ngIf="f.submitted && !ddl_ambiti.valid" class="help-block">Ambiti is required</div>
                </div>
            </div>
            <div class="ui-grid-row">

                <div class="ui-grid-col-12 ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                                <label for="ddl_aree" style="top: -.60em;font-size:12px; color:#d6d6d6">Macro Area</label>
                            </span>
                    <p-dropdown [ngModelOptions]="{standalone: true}" #ddl_aree name="ddl_aree" [options]="lst_aree" [(ngModel)]="newRowConsuntivo.id_macro_area" required="true" appendTo="body"
                        placeholder="Seleziona Area" [autoWidth]="false" [style]="{'width':'100%'}"></p-dropdown>
                    <div *ngIf="f.submitted && !ddl_aree.valid" class="help-block">Area is required</div>
                </div>
            </div>
            <div class="ui-grid-row">

                <div class="ui-grid-col-12 ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                                <label for="ddl_attivita" style="top: -.60em;font-size:12px; color:#d6d6d6">Attività</label>
                            </span>
                    <p-dropdown [ngModelOptions]="{standalone: true}" #ddl_attivita name="ddl_attivita" [options]="lst_attivita" [(ngModel)]="newRowConsuntivo.id_attivita" required="true"
                        appendTo="body" placeholder="Seleziona attività" [autoWidth]="false" [style]="{'width':'100%'}"></p-dropdown>
                    <div *ngIf="f.submitted && !ddl_attivita.valid" class="help-block">Attività is required</div>
                </div>
            </div>
            <div class="ui-grid-row">
                <div class="ui-grid-col-12 ui-g-12 ui-md-12">
                    <span class="ui-float-label">
                                <label for="ddl_deliverable" style="top: -.60em;font-size:12px; color:#d6d6d6">Deliverable</label>
                            </span>
                    <p-dropdown [ngModelOptions]="{standalone: true}" #ddl_deliverable name="ddl_deliverable" [options]="lst_deliverable" [(ngModel)]="newRowConsuntivo.id_tipo_deliverable"
                        required="true" appendTo="body" placeholder="Seleziona deliverable" [autoWidth]="false" [style]="{'width':'100%'}"></p-dropdown>
                    <div *ngIf="f.submitted && !ddl_deliverable.valid" class="help-block">Deliverable is required</div>
                </div>
            </div>
        </div>
        <p-footer>
            <div class="ui-dialog-buttonpane ui-helper-clearfix">
                <button pButton class="btn btn-primary btnPrimary" label="Save">Salva</button>
                <button type="button" pButton class="btn btn-primary btnPrimary" (click)="abortNew()" label="Abort">Annulla</button>
            </div>
        </p-footer>
    </form>
</p-dialog>